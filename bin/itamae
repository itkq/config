#!/bin/sh

itamae_version="0.0.9"

case "$(uname)" in
  "Linux"  ) itamae_bin="itamae-x86_64-linux" ;;
  "Darwin" ) itamae_bin="itamae-x86_64-darwin" ;;
  * ) echo "unexpected uname: $(uname)"; exit 1 ;;
esac

itamae="bin/${itamae_bin}-${itamae_version}"
if ! [ -f "${itamae}" ]; then
  itamae_url="https://github.com/k0kubun/itamae-mruby/releases/download/v${itamae_version}/${itamae_bin}.zip"
  if ! curl -L "$itamae_url" > "bin/${itamae_bin}.zip"; then
    echo "failed to download itamae!"
    exit 1
  fi
  unzip "bin/${itamae_bin}.zip"
  mv "${itamae_bin}" "${itamae}"
  chmod +x "${itamae}"
fi

exec "${itamae}" $@
